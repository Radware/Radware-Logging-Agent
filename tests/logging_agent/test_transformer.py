import pytest
from unittest.mock import patch
from logging_agent.transformer import Transformer
from logging_agent.cloud_waap.cloudwaap_log_utils import CloudWAAPProcessor
import json



log_examples = {
    "Access": [
        {
            "metadata": {"tenant_name":"DEMO", "application_name":"CWAF Secure Demo"},
            "original": [{'time': '27/Jan/2024:00:49:40 +0000', 'source_ip': '50.1.154.77', 'source_port': 43834, 'destination_ip': '66.22.79.113', 'destination_port': 443, 'protocol': 'https', 'http_method': 'POST', 'host': 'securedemo.radware.net', 'request': 'POST /user/login HTTP/1.1', 'directory': '/user', 'user_agent': 'Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko', 'accept_language': 'en-US,en;q=0.9', 'x-forwarded-for': '-', 'referrer': '-', 'cookie': '-', 'request_time': '0.114', 'response_code': 200, 'http_bytes_in': 535, 'http_bytes_out': 7607, 'country_code': 'US', 'action': 'Allowed', 'application_id': 'cb64959b-2f53-41f2-87ad-9c5810313a74', 'application_name': 'CWAF Secure Demo', 'tenant_name': 'DEMO'}],
            "enriched_cef_leef ": {'time': '01 27 2024 00:49:40', 'source_ip': '50.1.154.77', 'source_port': 43834, 'destination_ip': '66.22.79.113', 'destination_port': 443, 'protocol': 'https', 'http_method': 'POST', 'host': 'securedemo.radware.net', 'request': 'https://securedemo.radware.net/user/login', 'directory': '/user', 'user_agent': 'Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko', 'accept_language': 'en-US,en;q=0.9', 'x-forwarded-for': '-', 'request_time': '0.114', 'response_code': 200, 'http_bytes_in': 535, 'http_bytes_out': 7607, 'country_code': 'US', 'action': 'Allowed', 'application_id': 'cb64959b-2f53-41f2-87ad-9c5810313a74', 'application_name': 'CWAF Secure Demo', 'tenant_name': 'DEMO', 'http_version': 'HTTP/1.1', 'uri': '/user/login'},
            "transformed": {
                "json": [{'time': '01 27 2024 00:49:40', 'source_ip': '50.1.154.77', 'source_port': 43834, 'destination_ip': '66.22.79.113', 'destination_port': 443, 'protocol': 'https', 'http_method': 'POST', 'host': 'securedemo.radware.net', 'request': 'https://securedemo.radware.net/user/login', 'directory': '/user', 'user_agent': 'Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko', 'accept_language': 'en-US,en;q=0.9', 'x-forwarded-for': '-', 'request_time': '0.114', 'response_code': 200, 'http_bytes_in': 535, 'http_bytes_out': 7607, 'country_code': 'US', 'action': 'Allowed', 'application_id': 'cb64959b-2f53-41f2-87ad-9c5810313a74', 'application_name': 'CWAF Secure Demo', 'tenant_name': 'DEMO', 'log_type': 'Access', 'http_version': 'HTTP/1.1', 'uri': '/user/login'}],
                "cef": ["02 04 2024 19:13:50 Radware-CloudWAAP CEF:0|Radware|Cloud WAAP|1.0|Access|Access Log|Info| rt=01 27 2024 00:49:40 act=Allowed dhost=securedemo.radware.net src=50.1.154.77 dst=66.22.79.113 spt=43834 dpt=443 app=https request=https://securedemo.radware.net/user/login uri=/user/login method=POST in=535 out=7607 requestClientApplication=Mozilla/5.0 (Windows NT 6.1\; Trident/7.0\; rv:11.0) like Gecko rdwrCldDirectory=/user rdwrCldAcceptLanguage=en-US\,en\;q\=0.9 rdwrCldRequestTime=0.114 rdwrCldResponseCode=200 rdwrCldCountryCode=US rdwrCldApplicationId=cb64959b-2f53-41f2-87ad-9c5810313a74 rdwrCldApplicationName=CWAF Secure Demo rdwrCldTenantName=DEMO rdwrCldHttpVersion=HTTP/1.1"],
                "leef": ["02 04 2024 20:17:00 Radware-CloudWAAP LEEF:2.0|Radware|Cloud WAAP|1.0|Access|eventTime=01 27 2024 00:49:40	action=Allowed	dhost=securedemo.radware.net	src=50.1.154.77	dst=66.22.79.113	srcPort=43834	dstPort=443	proto=https	url=https://securedemo.radware.net/user/login	uri=/user/login	method=POST	bytesIn=535	bytesOut=7607	userAgent=Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko	responseCode=200	rdwrCldDirectory=/user	rdwrCldAcceptLanguage=en-US,en;q\=0.9	rdwrCldRequestTime=0.114	rdwrCldCountryCode=US	rdwrCldApplicationId=cb64959b-2f53-41f2-87ad-9c5810313a74	rdwrCldApplicationName=CWAF Secure Demo	rdwrCldTenantName=DEMO	rdwrCldHttpVersion=HTTP/1.1"]
            }
        },
        # Add more examples for Access log type
    ],
    "WAF": [
        {
            "metadata": {"tenant_name": "DEMO", "application_name": "CWAF Secure Demo"},
            "original": [{'applicationName': 'CWAF Secure Demo', 'action': 'Blocked', 'appPath': '/api/auth', 'destinationIp': '10.35.101.159', 'destinationPort': '54009', 'directory': '/api', 'enrichmentContainer': {'geoLocation.countryCode': 'US', 'contractId': '63bce674-e83d-4fae-909d-84b309ba0cd9', 'applicationId': 'cb64959b-2f53-41f2-87ad-9c5810313a74', 'tenant': '75292c67-8443-4714-babe-851b29de7cab'}, 'externalIp': '128.160.218.10', 'host': 'securedemo.radware.net', 'method': 'POST', 'protocol': 'HTTP', 'receivedTimeStamp': '1706313459865', 'request': 'POST /api/auth HTTP/1.1\r\nAccept-Encoding: gzip\r\nHost: securedemo.radware.net\r\nX-RDWR-IP: 128.160.218.10\r\nX-RDWR-PORT: 48400\r\nX-RDWR-PORT-MM-ORIG-FE-PORT: 443\r\nX-RDWR-PORT-MM: 443\r\nX-RDWR-APP-ID: cb64959b-2f53-41f2-87ad-9c5810313a74\r\nContent-Length: 0\r\nUser-Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:87.0) Gecko/20100101 Firefox/87.0\r\naccept: application/json\r\nx-remote-ip: 128.160.218.10\r\ncontent-type: application/json\r\nNotBot: True\r\nAuthorization: Basic dGVzdF91c2VyOjEyMzQ1Ng==\r\nCookie: uzmx=7f9000d9fb47c7-bb6d-4df7-8f02-3dadb93210731-17063028541647068335-3f843db00cc4acfa31; AWSALB=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67; AWSALBCORS=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67; PHPSESSID=4dnugf61f9dahuqms16rnid4b7; __uzma=ccac7062-d197-46d3-ae9f-5ea957f0cfa6; __uzmb=1706302854; __uzmc=746603198630; __uzmd=1706309922; __uzme=9535; __uzmf=7f6000a01e6cf7-1ddb-42d9-bc8c-2431ac1bb85617063028541647068335-630a7dc09778429631\r\nShieldSquare-Response: 0\r\n\r\n', 'role': 'public', 'security': True, 'severity': 'High', 'sourceIp': '128.160.218.10', 'sourcePort': '59289', 'targetModule': 'API Security Module', 'title': 'API request method not allowed', 'transId': '2669954742', 'URI': '/api/auth', 'user': 'public', 'vhost': 'securedemo.radware.net', 'violationCategory': 'API Security Violation', 'violationDetails': 'A user attempted to access an API endpoint using an HTTP Method that is not allowed.\n\r\nDescription:\r\nAPI Security Violation Detected.\nEndpoint:  /api/auth\nMethod: POST\nViolation: Invalid Method.\nInvalid method\n\r\nSuggestion: Revise API Security settings if needed\r\nModule: API Security\r\nError Number: -216\r\n\nAuthenticated as Public\n', 'violationType': 'API Security Violation', 'webApp': 'App_DEMO_CWAF_Secure_Demo'}],
            "enriched_cef_leef": {'action': 'Blocked', 'appPath': '/api/auth', 'destinationIp': '10.35.101.159', 'directory': '/api', 'host': 'securedemo.radware.net', 'protocol': 'HTTP', 'request': 'HTTP://securedemo.radware.net/api/auth', 'role': 'public', 'security': True, 'severity': 'High', 'targetModule': 'API Security Module', 'user': 'public', 'vhost': 'securedemo.radware.net', 'violationType': 'API Security Violation', 'webApp': 'App_DEMO_CWAF_Secure_Demo', 'tenant_name': 'DEMO', 'time': '01 26 2024 23:57:39', 'application_name': 'CWAF Secure Demo', 'source_ip': '128.160.218.10', 'destination_ip': '128.160.218.10', 'source_port': '59289', 'destination_port': '54009', 'uri': '/api/auth', 'name': 'API request method not allowed', 'category': 'API Security Violation', 'reason': 'A user attempted to access an API endpoint using an HTTP Method that is not allowed.\n\r\nDescription:\r\nAPI Security Violation Detected.\nEndpoint:  /api/auth\nMethod: POST\nViolation: Invalid Method.\nInvalid method\n\r\nSuggestion: Revise API Security settings if needed\r\nModule: API Security\r\nError Number: -216\r\n\nAuthenticated as Public\n', 'trans_id': '2669954742', 'country_code': 'US', 'application_id': 'cb64959b-2f53-41f2-87ad-9c5810313a74', 'contract_id': '63bce674-e83d-4fae-909d-84b309ba0cd9', 'tenant_id': '75292c67-8443-4714-babe-851b29de7cab', 'http_method': 'POST', 'http_version': 'HTTP/1.1', 'cookie': 'uzmx=7f9000d9fb47c7-bb6d-4df7-8f02-3dadb93210731-17063028541647068335-3f843db00cc4acfa31; AWSALB=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67; AWSALBCORS=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67; PHPSESSID=4dnugf61f9dahuqms16rnid4b7; __uzma=ccac7062-d197-46d3-ae9f-5ea957f0cfa6; __uzmb=1706302854; __uzmc=746603198630; __uzmd=1706309922; __uzme=9535; __uzmf=7f6000a01e6cf7-1ddb-42d9-bc8c-2431ac1bb85617063028541647068335-630a7dc09778429631', 'user_agent': 'Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:87.0) Gecko/20100101 Firefox/87.0', 'referrer': '', 'headers': 'Accept-Encoding: gzip; Host: securedemo.radware.net; X-RDWR-IP: 128.160.218.10; X-RDWR-PORT: 48400; X-RDWR-PORT-MM-ORIG-FE-PORT: 443; X-RDWR-PORT-MM: 443; X-RDWR-APP-ID: cb64959b-2f53-41f2-87ad-9c5810313a74; Content-Length: 0; User-Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:87.0) Gecko/20100101 Firefox/87.0; accept: application/json; x-remote-ip: 128.160.218.10; content-type: application/json; NotBot: True; Authorization: Basic dGVzdF91c2VyOjEyMzQ1Ng==; Cookie: uzmx=7f9000d9fb47c7-bb6d-4df7-8f02-3dadb93210731-17063028541647068335-3f843db00cc4acfa31; AWSALB=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67; AWSALBCORS=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67; PHPSESSID=4dnugf61f9dahuqms16rnid4b7; __uzma=ccac7062-d197-46d3-ae9f-5ea957f0cfa6; __uzmb=1706302854; __uzmc=746603198630; __uzmd=1706309922; __uzme=9535; __uzmf=7f6000a01e6cf7-1ddb-42d9-bc8c-2431ac1bb85617063028541647068335-630a7dc09778429631; ShieldSquare-Response: 0'},
            "transformed": {
                "json": [{'action': 'Blocked', 'appPath': '/api/auth', 'destinationIp': '10.35.101.159', 'directory': '/api', 'host': 'securedemo.radware.net', 'protocol': 'HTTP', 'request': 'HTTP://securedemo.radware.net/api/auth', 'role': 'public', 'security': True, 'severity': 'High', 'targetModule': 'API Security Module', 'user': 'public', 'vhost': 'securedemo.radware.net', 'violationType': 'API Security Violation', 'webApp': 'App_DEMO_CWAF_Secure_Demo', 'log_type': 'WAF', 'tenant_name': 'DEMO', 'time': '01 26 2024 23:57:39', 'application_name': 'CWAF Secure Demo', 'source_ip': '128.160.218.10', 'destination_ip': '128.160.218.10', 'source_port': '59289', 'destination_port': '54009', 'uri': '/api/auth', 'name': 'API request method not allowed', 'category': 'API Security Violation', 'reason': 'A user attempted to access an API endpoint using an HTTP Method that is not allowed.\n\r\nDescription:\r\nAPI Security Violation Detected.\nEndpoint:  /api/auth\nMethod: POST\nViolation: Invalid Method.\nInvalid method\n\r\nSuggestion: Revise API Security settings if needed\r\nModule: API Security\r\nError Number: -216\r\n\nAuthenticated as Public\n', 'trans_id': '2669954742', 'country_code': 'US', 'application_id': 'cb64959b-2f53-41f2-87ad-9c5810313a74', 'contract_id': '63bce674-e83d-4fae-909d-84b309ba0cd9', 'tenant_id': '75292c67-8443-4714-babe-851b29de7cab', 'http_method': 'POST', 'http_version': 'HTTP/1.1', 'cookie': 'uzmx=7f9000d9fb47c7-bb6d-4df7-8f02-3dadb93210731-17063028541647068335-3f843db00cc4acfa31; AWSALB=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67; AWSALBCORS=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67; PHPSESSID=4dnugf61f9dahuqms16rnid4b7; __uzma=ccac7062-d197-46d3-ae9f-5ea957f0cfa6; __uzmb=1706302854; __uzmc=746603198630; __uzmd=1706309922; __uzme=9535; __uzmf=7f6000a01e6cf7-1ddb-42d9-bc8c-2431ac1bb85617063028541647068335-630a7dc09778429631', 'user_agent': 'Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:87.0) Gecko/20100101 Firefox/87.0', 'referrer': '', 'headers': 'Accept-Encoding: gzip; Host: securedemo.radware.net; X-RDWR-IP: 128.160.218.10; X-RDWR-PORT: 48400; X-RDWR-PORT-MM-ORIG-FE-PORT: 443; X-RDWR-PORT-MM: 443; X-RDWR-APP-ID: cb64959b-2f53-41f2-87ad-9c5810313a74; Content-Length: 0; User-Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:87.0) Gecko/20100101 Firefox/87.0; accept: application/json; x-remote-ip: 128.160.218.10; content-type: application/json; NotBot: True; Authorization: Basic dGVzdF91c2VyOjEyMzQ1Ng==; Cookie: uzmx=7f9000d9fb47c7-bb6d-4df7-8f02-3dadb93210731-17063028541647068335-3f843db00cc4acfa31; AWSALB=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67; AWSALBCORS=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67; PHPSESSID=4dnugf61f9dahuqms16rnid4b7; __uzma=ccac7062-d197-46d3-ae9f-5ea957f0cfa6; __uzmb=1706302854; __uzmc=746603198630; __uzmd=1706309922; __uzme=9535; __uzmf=7f6000a01e6cf7-1ddb-42d9-bc8c-2431ac1bb85617063028541647068335-630a7dc09778429631; ShieldSquare-Response: 0'}],
                "cef": ["02 04 2024 20:27:31 Radware-CloudWAAP CEF:0|Radware|Cloud WAAP|1.0|WAF|API request method not allowed|High| rt=01 26 2024 23:57:39 act=Blocked dhost=securedemo.radware.net src=128.160.218.10 dst=128.160.218.10 spt=59289 dpt=54009 app=HTTP requestMethod=POST request=HTTP://securedemo.radware.net/api/auth uri=/api/auth reason=A user attempted to access an API endpoint using an HTTP Method that is not allowed.\n\r\nDescription:\r\nAPI Security Violation Detected.\nEndpoint:  /api/auth\nMethod: POST\nViolation: Invalid Method.\nInvalid method\n\r\nSuggestion: Revise API Security settings if needed\r\nModule: API Security\r\nError Number: -216\r\n\nAuthenticated as Public\n cat=API Security Violation requestClientApplication=Mozilla/5.0 (Windows NT 6.3\; Win64\; x64\; rv:87.0) Gecko/20100101 Firefox/87.0 requestCookies=uzmx\=7f9000d9fb47c7-bb6d-4df7-8f02-3dadb93210731-17063028541647068335-3f843db00cc4acfa31\; AWSALB\=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67\; AWSALBCORS\=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67\; PHPSESSID\=4dnugf61f9dahuqms16rnid4b7\; __uzma\=ccac7062-d197-46d3-ae9f-5ea957f0cfa6\; __uzmb\=1706302854\; __uzmc\=746603198630\; __uzmd\=1706309922\; __uzme\=9535\; __uzmf\=7f6000a01e6cf7-1ddb-42d9-bc8c-2431ac1bb85617063028541647068335-630a7dc09778429631 rdwrCldAppPath=/api/auth rdwrCldDestinationIp=10.35.101.159 rdwrCldDirectory=/api rdwrCldRole=public rdwrCldSecurity=True rdwrCldSeverity=High rdwrCldTargetModule=API Security Module rdwrCldUser=public rdwrCldVhost=securedemo.radware.net rdwrCldViolationType=API Security Violation rdwrCldWebApp=App_DEMO_CWAF_Secure_Demo rdwrCldTenantName=DEMO rdwrCldApplicationName=CWAF Secure Demo rdwrCldName=API request method not allowed rdwrCldTransId=2669954742 rdwrCldCountryCode=US rdwrCldApplicationId=cb64959b-2f53-41f2-87ad-9c5810313a74 rdwrCldContractId=63bce674-e83d-4fae-909d-84b309ba0cd9 rdwrCldTenantId=75292c67-8443-4714-babe-851b29de7cab rdwrCldHttpVersion=HTTP/1.1 rdwrCldHeaders=Accept-Encoding: gzip\; Host: securedemo.radware.net\; X-RDWR-IP: 128.160.218.10\; X-RDWR-PORT: 48400\; X-RDWR-PORT-MM-ORIG-FE-PORT: 443\; X-RDWR-PORT-MM: 443\; X-RDWR-APP-ID: cb64959b-2f53-41f2-87ad-9c5810313a74\; Content-Length: 0\; User-Agent: Mozilla/5.0 (Windows NT 6.3\; Win64\; x64\; rv:87.0) Gecko/20100101 Firefox/87.0\; accept: application/json\; x-remote-ip: 128.160.218.10\; content-type: application/json\; NotBot: True\; Authorization: Basic dGVzdF91c2VyOjEyMzQ1Ng\=\=\; Cookie: uzmx\=7f9000d9fb47c7-bb6d-4df7-8f02-3dadb93210731-17063028541647068335-3f843db00cc4acfa31\; AWSALB\=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67\; AWSALBCORS\=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67\; PHPSESSID\=4dnugf61f9dahuqms16rnid4b7\; __uzma\=ccac7062-d197-46d3-ae9f-5ea957f0cfa6\; __uzmb\=1706302854\; __uzmc\=746603198630\; __uzmd\=1706309922\; __uzme\=9535\; __uzmf\=7f6000a01e6cf7-1ddb-42d9-bc8c-2431ac1bb85617063028541647068335-630a7dc09778429631\; ShieldSquare-Response: 0"],
                "leef": ['02 04 2024 20:35:55 Radware-CloudWAAP LEEF:2.0|Radware|Cloud WAAP|1.0|WAF|eventTime=01 26 2024 23:57:39\taction=Blocked\tdhost=securedemo.radware.net\tsrc=128.160.218.10\tdst=128.160.218.10\tsrcPort=59289\tdstPort=54009\tproto=HTTP\tmethod=POST\trequest=HTTP://securedemo.radware.net/api/auth\turi=/api/auth\tname=API request method not allowed\treason=A user attempted to access an API endpoint using an HTTP Method that is not allowed.\\n\r\\nDescription:\r\\nAPI Security Violation Detected.\\nEndpoint:  /api/auth\\nMethod: POST\\nViolation: Invalid Method.\\nInvalid method\\n\r\\nSuggestion: Revise API Security settings if needed\r\\nModule: API Security\r\\nError Number: -216\r\\n\\nAuthenticated as Public\\n\tcat=API Security Violation\tcookie=uzmx\\=7f9000d9fb47c7-bb6d-4df7-8f02-3dadb93210731-17063028541647068335-3f843db00cc4acfa31; AWSALB\\=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67; AWSALBCORS\\=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67; PHPSESSID\\=4dnugf61f9dahuqms16rnid4b7; __uzma\\=ccac7062-d197-46d3-ae9f-5ea957f0cfa6; __uzmb\\=1706302854; __uzmc\\=746603198630; __uzmd\\=1706309922; __uzme\\=9535; __uzmf\\=7f6000a01e6cf7-1ddb-42d9-bc8c-2431ac1bb85617063028541647068335-630a7dc09778429631\tuserAgent=Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:87.0) Gecko/20100101 Firefox/87.0\tsev=High\trdwrCldAppPath=/api/auth\trdwrCldDestinationIp=10.35.101.159\trdwrCldDirectory=/api\trdwrCldRole=public\trdwrCldSecurity=True\trdwrCldTargetModule=API Security Module\trdwrCldUser=public\trdwrCldVhost=securedemo.radware.net\trdwrCldViolationType=API Security Violation\trdwrCldWebApp=App_DEMO_CWAF_Secure_Demo\trdwrCldTenantName=DEMO\trdwrCldApplicationName=CWAF Secure Demo\trdwrCldTransId=2669954742\trdwrCldCountryCode=US\trdwrCldApplicationId=cb64959b-2f53-41f2-87ad-9c5810313a74\trdwrCldContractId=63bce674-e83d-4fae-909d-84b309ba0cd9\trdwrCldTenantId=75292c67-8443-4714-babe-851b29de7cab\trdwrCldHttpVersion=HTTP/1.1\trdwrCldHeaders=Accept-Encoding: gzip; Host: securedemo.radware.net; X-RDWR-IP: 128.160.218.10; X-RDWR-PORT: 48400; X-RDWR-PORT-MM-ORIG-FE-PORT: 443; X-RDWR-PORT-MM: 443; X-RDWR-APP-ID: cb64959b-2f53-41f2-87ad-9c5810313a74; Content-Length: 0; User-Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64; rv:87.0) Gecko/20100101 Firefox/87.0; accept: application/json; x-remote-ip: 128.160.218.10; content-type: application/json; NotBot: True; Authorization: Basic dGVzdF91c2VyOjEyMzQ1Ng\\=\\=; Cookie: uzmx\\=7f9000d9fb47c7-bb6d-4df7-8f02-3dadb93210731-17063028541647068335-3f843db00cc4acfa31; AWSALB\\=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67; AWSALBCORS\\=5CC+YSlWg/q1gxJo57B6zyn7DOvEsh9j3Yh+ntD9vgLUZjwTY1keKdHU9m7EzZzk6863YyAev/Nzs61OZVx0UGtPuzHZIW8bLIhYQbmZ3p+kiy9eLNP8+IYmKN67; PHPSESSID\\=4dnugf61f9dahuqms16rnid4b7; __uzma\\=ccac7062-d197-46d3-ae9f-5ea957f0cfa6; __uzmb\\=1706302854; __uzmc\\=746603198630; __uzmd\\=1706309922; __uzme\\=9535; __uzmf\\=7f6000a01e6cf7-1ddb-42d9-bc8c-2431ac1bb85617063028541647068335-630a7dc09778429631; ShieldSquare-Response: 0']

            }
        },
        # Add more examples for WAF log type
    ],
    "Bot": [
        {
            "metadata": {"tenant_name": "DEMO", "application_name": "CWAF Secure Demo"},
            "original": [{'application_name': 'CWAF Secure Demo', 'action': 'Challenge CAPTCHA', 'tid': 'dd8282d1-c2vf-438f-92ba-b1175a2bc389', 'status': 'Mitigated', 'time': 1706313370266, 'site': 'securedemo.radware.net', 'url': 'https://securedemo.radware.net/api/customerAddress', 'ip': '67.21.80.136', 'country_code': 'US', 'bot_category': 'Programmatic Session behavior', 'referrer': '', 'ua': 'Mozilla/5.0 (Windows NT 10.0; Trident/7.0; rv:11.0) like Gecko', 'session_cookie': 'ea2590b0-2e40-4686-81f0-36f4186c9e34', 'headers': 'Accept : application/json, Accept-Language : , Accept-Encoding : gzip, deflate ', 'violation_reason': 'Programmatic browser behavior', 'policy_id': 'rabce4', 'signature_pattern': 'IP:67.21.80.136; User Session: '}],
            "enriched_cef_leef": {'application_name': 'CWAF Secure Demo', 'action': 'Challenge CAPTCHA', 'status': 'Mitigated', 'time': '01 26 2024 23:56:10', 'country_code': 'US', 'referrer': '', 'session_cookie': 'ea2590b0-2e40-4686-81f0-36f4186c9e34', 'headers': 'Accept : application/json, Accept-Language : , Accept-Encoding : gzip, deflate ', 'policy_id': 'rabce4', 'signature_pattern': 'IP:67.21.80.136; User Session: ', 'tenant_name': 'DEMO', 'source_ip': '67.21.80.136', 'user_agent': 'Mozilla/5.0 (Windows NT 10.0; Trident/7.0; rv:11.0) like Gecko', 'reason': 'Programmatic browser behavior', 'category': 'Programmatic Session behavior', 'host': 'securedemo.radware.net', 'trans_id': 'dd8282d1-c2vf-438f-92ba-b1175a2bc389', 'request': 'https://securedemo.radware.net/api/customerAddress', 'uri': '/api/customerAddress'},
            "transformed": {
                "json": [{'application_name': 'CWAF Secure Demo', 'action': 'Challenge CAPTCHA', 'status': 'Mitigated', 'time': '01 26 2024 23:56:10', 'country_code': 'US', 'referrer': '', 'session_cookie': 'ea2590b0-2e40-4686-81f0-36f4186c9e34', 'headers': 'Accept : application/json, Accept-Language : , Accept-Encoding : gzip, deflate ', 'policy_id': 'rabce4', 'signature_pattern': 'IP:67.21.80.136; User Session: ', 'log_type': 'Bot', 'tenant_name': 'DEMO', 'source_ip': '67.21.80.136', 'user_agent': 'Mozilla/5.0 (Windows NT 10.0; Trident/7.0; rv:11.0) like Gecko', 'reason': 'Programmatic browser behavior', 'category': 'Programmatic Session behavior', 'host': 'securedemo.radware.net', 'trans_id': 'dd8282d1-c2vf-438f-92ba-b1175a2bc389', 'request': 'https://securedemo.radware.net/api/customerAddress', 'uri': '/api/customerAddress'}],
                "cef": ['02 04 2024 20:39:08 Radware-CloudWAAP CEF:0|Radware|Cloud WAAP|1.0|Bot|Bot|Info| rt=01 26 2024 23:56:10 act=Challenge CAPTCHA dhost=securedemo.radware.net src=67.21.80.136 request=https://securedemo.radware.net/api/customerAddress uri=/api/customerAddress reason=Programmatic browser behavior cat=Programmatic Session behavior requestClientApplication=Mozilla/5.0 (Windows NT 10.0\\; Trident/7.0\\; rv:11.0) like Gecko rdwrCldApplicationName=CWAF Secure Demo rdwrCldStatus=Mitigated rdwrCldCountryCode=US rdwrCldSessionCookie=ea2590b0-2e40-4686-81f0-36f4186c9e34 rdwrCldHeaders=Accept : application/json\\, Accept-Language : \\, Accept-Encoding : gzip\\, deflate  rdwrCldPolicyId=rabce4 rdwrCldSignaturePattern=IP:67.21.80.136\\; User Session:  rdwrCldTenantName=DEMO rdwrCldTransId=dd8282d1-c2vf-438f-92ba-b1175a2bc389'],
                "leef": ['02 04 2024 20:38:09 Radware-CloudWAAP LEEF:2.0|Radware|Cloud WAAP|1.0|Bot|eventTime=01 26 2024 23:56:10\taction=Challenge CAPTCHA\tdhost=securedemo.radware.net\tsrc=67.21.80.136\trequest=https://securedemo.radware.net/api/customerAddress\turi=/api/customerAddress\treason=Programmatic browser behavior\tcat=Programmatic Session behavior\tuserAgent=Mozilla/5.0 (Windows NT 10.0; Trident/7.0; rv:11.0) like Gecko\trdwrCldApplicationName=CWAF Secure Demo\trdwrCldStatus=Mitigated\trdwrCldCountryCode=US\trdwrCldSessionCookie=ea2590b0-2e40-4686-81f0-36f4186c9e34\trdwrCldHeaders=Accept : application/json, Accept-Language : , Accept-Encoding : gzip, deflate \trdwrCldPolicyId=rabce4\trdwrCldSignaturePattern=IP:67.21.80.136; User Session: \trdwrCldTenantName=DEMO\trdwrCldTransId=dd8282d1-c2vf-438f-92ba-b1175a2bc389']
            }
        },
        # Add more examples for Bot log type
    ],
    "DDoS": [
        {
            "metadata": {"tenant_name": "DEMO", "application_name": "CWAF Secure Demo"},
            "original": [{'applicationName': 'CWAF Secure Demo', 'destinationIP': '66.22.79.113', 'destinationPort': '19599', 'totalVolume': 78, 'protocol': 'TCP', 'sourceIP': '111.39.230.46', 'sourcePort': '58151', 'name': 'Invalid TCP Flags', 'category': 'Anomalies', 'enrichmentContainer': {'geoLocation.countryCode': 'CN', 'contractId': '63bce674-e83d-4fae-909d-84b309ba0cd9', 'applicationId': 'cb64959b-2f53-41f2-87ad-9c5810313a74', 'tenant': '75292c67-8443-4714-babe-851b29de7cab'}, 'ID': 'FFFFFFFF-FFFF-FFFF-000E-000064FD858F', 'action': 'drop', 'totalPackets': 1, 'country': 'CN', 'time': '27-01-2024 10:53:21'}],
            "enriched_cef_leef": {'totalVolume': 78, 'protocol': 'TCP', 'name': 'Invalid TCP Flags', 'category': 'Anomalies', 'action': 'drop', 'totalPackets': 1, 'time': '01 27 2024 08:53:21', 'tenant_name': 'DEMO', 'source_ip': '111.39.230.46', 'destination_ip': '66.22.79.113', 'source_port': '58151', 'destination_port': '19599', 'reason': 'Anomalies, Invalid TCP Flags', 'trans_id': 'FFFFFFFF-FFFF-FFFF-000E-000064FD858F', 'application_name': 'CWAF Secure Demo', 'country_code': 'CN', 'application_id': 'cb64959b-2f53-41f2-87ad-9c5810313a74', 'contract_id': '63bce674-e83d-4fae-909d-84b309ba0cd9', 'tenant_id': '75292c67-8443-4714-babe-851b29de7cab'},
            "transformed": {
                "json": [{'totalVolume': 78, 'protocol': 'TCP', 'name': 'Invalid TCP Flags', 'category': 'Anomalies', 'action': 'drop', 'totalPackets': 1, 'time': '01 27 2024 08:53:21', 'log_type': 'DDoS', 'tenant_name': 'DEMO', 'source_ip': '111.39.230.46', 'destination_ip': '66.22.79.113', 'source_port': '58151', 'destination_port': '19599', 'reason': 'Anomalies, Invalid TCP Flags', 'trans_id': 'FFFFFFFF-FFFF-FFFF-000E-000064FD858F', 'application_name': 'CWAF Secure Demo', 'country_code': 'CN', 'application_id': 'cb64959b-2f53-41f2-87ad-9c5810313a74', 'contract_id': '63bce674-e83d-4fae-909d-84b309ba0cd9', 'tenant_id': '75292c67-8443-4714-babe-851b29de7cab'}],
                "cef": ['02 04 2024 20:44:15 Radware-CloudWAAP CEF:0|Radware|CloudWAAP|1.0|DDoS|Invalid TCP Flags|Info| rt=01 27 2024 08:53:21 act=drop src=111.39.230.46 dst=66.22.79.113 spt=58151 dpt=19599 app=TCP reason=Anomalies\\, Invalid TCP Flags cat=Anomalies rdwrCldTotalVolume=78 rdwrCldName=Invalid TCP Flags rdwrCldTotalPackets=1 rdwrCldTenantName=DEMO rdwrCldTransId=FFFFFFFF-FFFF-FFFF-000E-000064FD858F rdwrCldApplicationName=CWAF Secure Demo rdwrCldCountryCode=CN rdwrCldApplicationId=cb64959b-2f53-41f2-87ad-9c5810313a74 rdwrCldContractId=63bce674-e83d-4fae-909d-84b309ba0cd9 rdwrCldTenantId=75292c67-8443-4714-babe-851b29de7cab'],
                "leef": ['02 04 2024 20:44:43 Radware-CloudWAAP LEEF:2.0|Radware|Cloud WAAP|1.0|DDoS|eventTime=01 27 2024 08:53:21\taction=drop\tsrc=111.39.230.46\tdst=66.22.79.113\tsrcPort=58151\tdstPort=19599\tproto=TCP\tname=Invalid TCP Flags\treason=Anomalies, Invalid TCP Flags\tcat=Anomalies\trdwrCldTotalVolume=78\trdwrCldTotalPackets=1\trdwrCldTenantName=DEMO\trdwrCldTransId=FFFFFFFF-FFFF-FFFF-000E-000064FD858F\trdwrCldApplicationName=CWAF Secure Demo\trdwrCldCountryCode=CN\trdwrCldApplicationId=cb64959b-2f53-41f2-87ad-9c5810313a74\trdwrCldContractId=63bce674-e83d-4fae-909d-84b309ba0cd9\trdwrCldTenantId=75292c67-8443-4714-babe-851b29de7cab']
            }
        },
        # Add more examples for Bot log type
    ],
    "WebDDoS": [
        {
            "metadata": {"tenant_name": "DEMO", "application_name": "New CWAF Automated Demo"},
            "original": [{'applicationName': 'New CWAF Automated Demo', 'currentTimestamp': '2024-01-27T01:00:28.597742015Z', 'enrichmentContainer': {'geoLocation.countryCode': '', 'contractId': '63bce674-e83d-4fae-909d-84b309ba0cd9', 'applicationId': '805c88ac-aaf9-471a-9030-391c0393990d', 'tenant': '75292c67-8443-4714-babe-851b29de7cab'}, 'attackID': '805c88ac-aaf9-471a-9030-391c0393990d-1706317220', 'action': 'Blocked', 'startTime': 1706317220, 'severity': 'Critical', 'attackVector': 'HTTP_Flood_Attack', 'host': 'autodemo.radware.net', 'status': 'Ongoing', 'latestRealTimeSignature': {'Pattern': [{'Name': 'cookies', 'Values': ['0']}, {'Name': 'header cache*', 'Values': ['true']}, {'Name': 'header content*', 'Values': ['false']}, {'Name': 'header pragma', 'Values': ['true']}, {'Name': 'header sec-*', 'Values': ['true']}, {'Name': 'header upgrade-insecure-requests', 'Values': ['true']}, {'Name': 'header via', 'Values': ['true']}, {'Name': 'known', 'Values': ['9']}, {'Name': 'method', 'Values': ['get']}, {'Name': 'path', 'Values': ['0']}, {'Name': 'query', 'Values': ['0']}, {'Name': 'unknown', 'Values': ['3']}]}, 'detection': {'ApplicationBehavior': {'attackThreshold': 39.14387}}, 'mitigation': {'totalRequests': {'received': 612.3, 'dropped': 0}, 'averageValues': 612.3, 'maximumValues': 612.3}, 'rps': {'inbound': 612.3, 'blocked': 0, 'clean': 612.3, 'attackThreshold': 39.14387}}],
            "enriched_cef_leef": {'currentTimestamp': '2024-01-27T01:00:28.597742015Z', 'action': 'Blocked', 'startTime': '01 20 1970 17:58:37', 'severity': 'Critical', 'host': 'autodemo.radware.net', 'status': 'Ongoing', 'latestRealTimeSignature': 'cookies: 0; header cache*: true; header content*: false; header pragma: true; header sec-*: true; header upgrade-insecure-requests: true; header via: true; known: 9; method: get; path: 0; query: 0; unknown: 3', 'tenant_name': 'DEMO', 'application_name': 'New CWAF Automated Demo', 'time': '01 26 2024 23:00:28', 'trans_id': '805c88ac-aaf9-471a-9030-391c0393990d-1706317220', 'reason': 'WebDDoS module has detected a HTTP_Flood_Attack', 'name': 'HTTP_Flood_Attack', 'category': 'HTTP_Flood_Attack', 'country_code': '', 'application_id': '805c88ac-aaf9-471a-9030-391c0393990d', 'contract_id': '63bce674-e83d-4fae-909d-84b309ba0cd9', 'tenant_id': '75292c67-8443-4714-babe-851b29de7cab', 'ApplicationBehavior_attackThreshold': 39.14387, 'totalRequests_received': 612.3, 'totalRequests_dropped': 0, 'averageValues': 612.3, 'maximumValues': 612.3, 'inbound': 612.3, 'blocked': 0, 'clean': 612.3, 'attackThreshold': 39.14387},
            "transformed": {
                "json": [{'currentTimestamp': '2024-01-27T01:00:28.597742015Z', 'action': 'Blocked', 'startTime': '01 20 1970 17:58:37', 'severity': 'Critical', 'host': 'autodemo.radware.net', 'status': 'Ongoing', 'latestRealTimeSignature': {'Pattern': [{'Name': 'cookies', 'Values': ['0']}, {'Name': 'header cache*', 'Values': ['true']}, {'Name': 'header content*', 'Values': ['false']}, {'Name': 'header pragma', 'Values': ['true']}, {'Name': 'header sec-*', 'Values': ['true']}, {'Name': 'header upgrade-insecure-requests', 'Values': ['true']}, {'Name': 'header via', 'Values': ['true']}, {'Name': 'known', 'Values': ['9']}, {'Name': 'method', 'Values': ['get']}, {'Name': 'path', 'Values': ['0']}, {'Name': 'query', 'Values': ['0']}, {'Name': 'unknown', 'Values': ['3']}]}, 'detection': {'ApplicationBehavior': {'attackThreshold': 39.14387}}, 'mitigation': {'totalRequests': {'received': 612.3, 'dropped': 0}, 'averageValues': 612.3, 'maximumValues': 612.3}, 'rps': {'inbound': 612.3, 'blocked': 0, 'clean': 612.3, 'attackThreshold': 39.14387}, 'log_type': 'WebDDoS', 'tenant_name': 'DEMO', 'application_name': 'New CWAF Automated Demo', 'time': '01 26 2024 23:00:28', 'trans_id': '805c88ac-aaf9-471a-9030-391c0393990d-1706317220', 'reason': 'WebDDoS module has detected a HTTP_Flood_Attack', 'name': 'HTTP_Flood_Attack', 'category': 'HTTP_Flood_Attack', 'country_code': '', 'application_id': '805c88ac-aaf9-471a-9030-391c0393990d', 'contract_id': '63bce674-e83d-4fae-909d-84b309ba0cd9', 'tenant_id': '75292c67-8443-4714-babe-851b29de7cab'}],
                "cef": ['02 04 2024 20:48:11 Radware-CloudWAAP CEF:0|Radware|Cloud WAAP|1.0|WebDDoS|HTTP_Flood_Attack|Critical| rt=01 26 2024 23:00:28 act=Blocked dhost=autodemo.radware.net reason=WebDDoS module has detected a HTTP_Flood_Attack category=HTTP_Flood_Attack start=01 20 1970 17:58:37 rdwrCldCurrentTimestamp=2024-01-27T01:00:28.597742015Z rdwrCldSeverity=Critical rdwrCldStatus=Ongoing rdwrCldLatestRealTimeSignature=cookies: 0\\; header cache*: true\\; header content*: false\\; header pragma: true\\; header sec-*: true\\; header upgrade-insecure-requests: true\\; header via: true\\; known: 9\\; method: get\\; path: 0\\; query: 0\\; unknown: 3 rdwrCldTenantName=DEMO rdwrCldApplicationName=New CWAF Automated Demo rdwrCldTransId=805c88ac-aaf9-471a-9030-391c0393990d-1706317220 rdwrCldName=HTTP_Flood_Attack rdwrCldApplicationId=805c88ac-aaf9-471a-9030-391c0393990d rdwrCldContractId=63bce674-e83d-4fae-909d-84b309ba0cd9 rdwrCldTenantId=75292c67-8443-4714-babe-851b29de7cab rdwrCldApplicationbehaviorAttackthreshold=39.14387 rdwrCldTotalrequestsReceived=612.3 rdwrCldTotalrequestsDropped=0 rdwrCldAverageValues=612.3 rdwrCldMaximumValues=612.3 rdwrCldInbound=612.3 rdwrCldBlocked=0 rdwrCldClean=612.3 rdwrCldAttackThreshold=39.14387'],
                "leef": ['02 04 2024 20:47:36 Radware-CloudWAAP LEEF:2.0|Radware|Cloud WAAP|1.0|WebDDoS|eventTime=01 26 2024 23:00:28\taction=Blocked\tdhost=autodemo.radware.net\tname=HTTP_Flood_Attack\treason=WebDDoS module has detected a HTTP_Flood_Attack\tcat=HTTP_Flood_Attack\tsev=Critical\tstartTime=01 20 1970 17:58:37\trdwrCldCurrentTimestamp=2024-01-27T01:00:28.597742015Z\trdwrCldStatus=Ongoing\trdwrCldLatestRealTimeSignature=cookies: 0; header cache*: true; header content*: false; header pragma: true; header sec-*: true; header upgrade-insecure-requests: true; header via: true; known: 9; method: get; path: 0; query: 0; unknown: 3\trdwrCldTenantName=DEMO\trdwrCldApplicationName=New CWAF Automated Demo\trdwrCldTransId=805c88ac-aaf9-471a-9030-391c0393990d-1706317220\trdwrCldApplicationId=805c88ac-aaf9-471a-9030-391c0393990d\trdwrCldContractId=63bce674-e83d-4fae-909d-84b309ba0cd9\trdwrCldTenantId=75292c67-8443-4714-babe-851b29de7cab\trdwrCldApplicationbehaviorAttackthreshold=39.14387\trdwrCldTotalrequestsReceived=612.3\trdwrCldTotalrequestsDropped=0\trdwrCldAverageValues=612.3\trdwrCldMaximumValues=612.3\trdwrCldInbound=612.3\trdwrCldBlocked=0\trdwrCldClean=612.3\trdwrCldAttackThreshold=39.14387']
            }
        },
        # Add more examples for Bot log type
    ],
    "CSP": [
        {
            "metadata": {"tenant_name": "DEMO", "application_name": "juiceshopSecure"},
            "original": [{'applicationName': 'juiceshopSecure', 'enrichmentContainer': {'geoLocation.countryCode': '', 'contractId': '63bce674-e83d-4fae-909d-84b309ba0cd9', 'applicationId': '12a3cfe3-3c39-4ecd-88d3-cea560f70bda', 'tenant': '75292c67-8443-4714-babe-851b29de7cab'}, 'severity': 'High', 'targetModule': 'Client-Side Protection', 'transId': '33498864', 'count': 1, 'aggregated': True, 'urls': ['https://juiceshopsecure.radwarecloud.com/#/search?q=%3Ciframe%20src%3D%22javascript:alert(%60This%20is%20XSS%20attack%20that%20WAF%20cannot%20block%60)%22%3E'], 'violationType': 'DOM Based XSS', 'host': 'juiceshopsecure.radwarecloud.com', 'action': 'Blocked', 'aggregatedUserAgent': ['Chrome'], 'details': 'Client-side protection intercepted a suspicious request, which includes a DOM Based XSS pattern.\nA DOM-based XSS attack is possible if the web application writes data to the DOM without proper sanitization.\nThe attacker can manipulate this data to include suspicious JavaScript code.\nPattern: script', 'receivedTimeStamp': '1706539344000', 'applicationId': '12a3cfe3-3c39-4ecd-88d3-cea560f70bda', 'externalIp': 0, 'domainName': ''}],
            "enriched_cef_leef": {'severity': 'High', 'targetModule': 'Client-Side Protection', 'count': 1, 'aggregated': True, 'urls': 'https://juiceshopsecure.radwarecloud.com/#/search?q=%3Ciframe%20src%3D%22javascript:alert(%60This%20is%20XSS%20attack%20that%20WAF%20cannot%20block%60)%22%3E', 'host': 'juiceshopsecure.radwarecloud.com', 'action': 'Blocked', 'aggregatedUserAgent': 'Chrome', 'externalIp': 0, 'domainName': '', 'tenant_name': 'DEMO', 'time': '01 29 2024 14:42:24', 'application_name': 'juiceshopSecure', 'name': 'DOM Based XSS', 'reason': 'Client-side protection intercepted a suspicious request, which includes a DOM Based XSS pattern.\nA DOM-based XSS attack is possible if the web application writes data to the DOM without proper sanitization.\nThe attacker can manipulate this data to include suspicious JavaScript code.\nPattern: script', 'trans_id': '33498864', 'country_code': '', 'application_id': '12a3cfe3-3c39-4ecd-88d3-cea560f70bda', 'contract_id': '63bce674-e83d-4fae-909d-84b309ba0cd9', 'tenant_id': '75292c67-8443-4714-babe-851b29de7cab'},
            "transformed": {
                "json": [{'severity': 'High', 'targetModule': 'Client-Side Protection', 'count': 1, 'aggregated': True, 'urls': ['https://juiceshopsecure.radwarecloud.com/#/search?q=%3Ciframe%20src%3D%22javascript:alert(%60This%20is%20XSS%20attack%20that%20WAF%20cannot%20block%60)%22%3E'], 'host': 'juiceshopsecure.radwarecloud.com', 'action': 'Blocked', 'aggregatedUserAgent': ['Chrome'], 'externalIp': 0, 'domainName': '', 'log_type': 'CSP', 'tenant_name': 'DEMO', 'time': '01 29 2024 14:42:24', 'application_name': 'juiceshopSecure', 'name': 'DOM Based XSS', 'reason': 'Client-side protection intercepted a suspicious request, which includes a DOM Based XSS pattern.\nA DOM-based XSS attack is possible if the web application writes data to the DOM without proper sanitization.\nThe attacker can manipulate this data to include suspicious JavaScript code.\nPattern: script', 'trans_id': '33498864', 'country_code': '', 'application_id': '12a3cfe3-3c39-4ecd-88d3-cea560f70bda', 'contract_id': '63bce674-e83d-4fae-909d-84b309ba0cd9', 'tenant_id': '75292c67-8443-4714-babe-851b29de7cab'}],
                "cef": ['02 04 2024 20:52:08 Radware-CloudWAAP CEF:0|Radware|Cloud WAAP|1.0|CSP|DOM Based XSS|High| rt=01 29 2024 14:42:24 act=Blocked dhost=juiceshopsecure.radwarecloud.com reason=Client-side protection intercepted a suspicious request\\, which includes a DOM Based XSS pattern.\\nA DOM-based XSS attack is possible if the web application writes data to the DOM without proper sanitization.\\nThe attacker can manipulate this data to include suspicious JavaScript code.\\nPattern: script cnt=1 rdwrCldSeverity=High rdwrCldTargetModule=Client-Side Protection rdwrCldAggregated=True rdwrCldUrls=https://juiceshopsecure.radwarecloud.com/#/search?q\\=%3Ciframe%20src%3D%22javascript:alert(%60This%20is%20XSS%20attack%20that%20WAF%20cannot%20block%60)%22%3E rdwrCldAggregatedUserAgent=Chrome rdwrCldExternalIp=0 rdwrCldTenantName=DEMO rdwrCldApplicationName=juiceshopSecure rdwrCldName=DOM Based XSS rdwrCldTransId=33498864 rdwrCldApplicationId=12a3cfe3-3c39-4ecd-88d3-cea560f70bda rdwrCldContractId=63bce674-e83d-4fae-909d-84b309ba0cd9 rdwrCldTenantId=75292c67-8443-4714-babe-851b29de7cab'],
                "leef": ['02 04 2024 20:52:35 Radware-CloudWAAP LEEF:2.0|Radware|Cloud WAAP|1.0|WebDDoS|eventTime=01 29 2024 14:42:24\taction=Blocked\tdhost=juiceshopsecure.radwarecloud.com\tname=DOM Based XSS\treason=Client-side protection intercepted a suspicious request, which includes a DOM Based XSS pattern.\\nA DOM-based XSS attack is possible if the web application writes data to the DOM without proper sanitization.\\nThe attacker can manipulate this data to include suspicious JavaScript code.\\nPattern: script\tsev=High\tcnt=1\trdwrCldTargetModule=Client-Side Protection\trdwrCldAggregated=True\trdwrCldUrls=https://juiceshopsecure.radwarecloud.com/#/search?q\\=%3Ciframe%20src%3D%22javascript:alert(%60This%20is%20XSS%20attack%20that%20WAF%20cannot%20block%60)%22%3E\trdwrCldAggregatedUserAgent=Chrome\trdwrCldExternalIp=0\trdwrCldTenantName=DEMO\trdwrCldApplicationName=juiceshopSecure\trdwrCldTransId=33498864\trdwrCldApplicationId=12a3cfe3-3c39-4ecd-88d3-cea560f70bda\trdwrCldContractId=63bce674-e83d-4fae-909d-84b309ba0cd9\trdwrCldTenantId=75292c67-8443-4714-babe-851b29de7cab']
            }
        },
        # Add more examples for Bot log type
    ],
}



@pytest.mark.parametrize("log_type,log_data", [
    (log_type, data)
    for log_type, examples in log_examples.items()
    for data in examples
])
def test_transformer_content(config_fixture, field_mappings, log_type, log_data, monkeypatch):
    # Mocking the external dependencies if any, like CloudWAAPProcessor's static methods
    monkeypatch.setattr(CloudWAAPProcessor, 'identify_log_type', lambda x: log_type)

    # Instantiating Transformer with the mocked config and field mappings
    transformer = Transformer(config=config_fixture)
    transformer.field_mappings = field_mappings  # Override field mappings for the test

    # Extracting test data
    original_logs = log_data['original']
    expected_json = log_data['transformed']['json']
    expected_cef = log_data['transformed']['cef']
    expected_leef = log_data['transformed']['leef']

    # Test JSON transformation
    transformed_json = transformer.transform_content(original_logs, {'log_type': log_type, 'metadata': {}},
                                                     batch_mode=False, format_options={})
    assert json.loads(transformed_json) == expected_json, "JSON transformation failed"

    # For CEF and LEEF, ensure the output format in the config is set correctly before calling transform_content
    config_fixture['output']['output_format'] = 'cef'
    transformed_cef = transformer.transform_content(original_logs, {'log_type': log_type, 'metadata': {}},
                                                    batch_mode=False, format_options={})
    assert transformed_cef == expected_cef, "CEF transformation failed"

    config_fixture['output']['output_format'] = 'leef'
    transformed_leef = transformer.transform_content(original_logs, {'log_type': log_type, 'metadata': {}},
                                                     batch_mode=False, format_options={})
    assert transformed_leef == expected_leef, "LEEF transformation failed"
